from shapely import Point

import roseau.load_flow as rlf

# Buses
buses = {
    1: rlf.Bus(id=1, phases="abcn", geometry=Point(0.0, 0.0)),
    2: rlf.Bus(id=2, phases="abc", geometry=Point(0.0, 1.0)),
    3: rlf.Bus(id=3, phases="abcn", geometry=Point(0.0, 1.0)),
    4: rlf.Bus(id=4, phases="abcn", geometry=Point(0.0, 1.0)),
    5: rlf.Bus(id=5, phases="abcn", geometry=Point(0.0, 1.0)),
    6: rlf.Bus(id=6, phases="abc", geometry=Point(0.0, 1.0)),
    7: rlf.Bus(id=7, phases="abcn", geometry=Point(0.0, 1.0)),
    8: rlf.Bus(id=8, phases="abc", geometry=Point(0.0, 1.0)),
    9: rlf.Bus(id=9, phases="abcn", geometry=Point(0.0, 1.0)),
    10: rlf.Bus(id=10, phases="abcn", geometry=Point(0.0, 1.0)),
    11: rlf.Bus(id=11, phases="abcn", geometry=Point(0.0, 1.0)),
    12: rlf.Bus(id=12, phases="abc", geometry=Point(0.0, 1.0)),
    13: rlf.Bus(id=13, phases="abcn", geometry=Point(0.0, 1.0)),
}

# Grounds and potential references
ground = rlf.Ground("ground")
for bus_id in (1, 3, 4, 5, 7, 9, 10, 11, 13):
    ground.connect(buses[bus_id])
potential_refs = [
    rlf.PotentialRef(id="pref", element=ground),
    rlf.PotentialRef(id="tr12", element=buses[2]),
    rlf.PotentialRef(id="tr56", element=buses[6]),
    rlf.PotentialRef(id="tr78", element=buses[8]),
    rlf.PotentialRef(id="tr1112", element=buses[12]),
]

# Sources and loads
vs = rlf.VoltageSource(
    id=1,
    bus=buses[1],
    voltages=[
        11547.005383792515 + 0.0j,
        -5773.502691896258 + -10000.000000179687j,
        -5773.502691896258 + 10000.000000179687j,
    ],
    phases="abcn",
)
loads = [
    rlf.PowerLoad(
        id=1,
        bus=buses[2],
        phases="abcn",
        powers=[
            41916.482229647016 + 20958.241114823508j,
            41916.482230776804 + 20958.2411153884j,
            41916.4822307768 + 20958.241115388402j,
        ],
    ),
    rlf.PowerLoad(
        id=2,
        bus=buses[3],
        phases="abcn",
        powers=[
            40459.7989783205 + 20229.89948916025j,
            40459.79897941102 + 20229.89948970551j,
            40459.79897941102 + 20229.89948970551j,
        ],
    ),
    rlf.PowerLoad(
        id=3,
        bus=buses[4],
        phases="abcn",
        powers=[
            37922.04164877094 + 18961.020824385465j,
            37922.04164985974 + 18961.020824929874j,
            37922.04164980375 + 18961.02082490188j,
        ],
    ),
    rlf.PowerLoad(
        id=4,
        bus=buses[5],
        phases="abcn",
        powers=[
            40459.798978684 + 20229.899489342002j,
            40459.79897977451 + 20229.89948988726j,
            40459.798978684004 + 20229.899489342002j,
        ],
    ),
    rlf.PowerLoad(
        id=5,
        bus=buses[6],
        phases="abcn",
        powers=[
            41916.48223002361 + 20958.24111501181j,
            41916.4822311534 + 20958.241115576697j,
            41916.48223002363 + 20958.241115011813j,
        ],
    ),
    rlf.PowerLoad(
        id=6,
        bus=buses[7],
        phases="abcn",
        powers=[
            40932.79932474136 + 20466.399662370677j,
            40932.79932583017 + 20466.39966291509j,
            40932.79932479737 + 20466.39966239868j,
        ],
    ),
    rlf.PowerLoad(
        id=7,
        bus=buses[8],
        phases="abcn",
        powers=[
            41916.482229647016 + 20958.241114823508j,
            41916.482230776804 + 20958.241115388402j,
            41916.4822307768 + 20958.241115388402j,
        ],
    ),
    rlf.PowerLoad(
        id=8,
        bus=buses[9],
        phases="abcn",
        powers=[
            40459.79897832049 + 20229.899489160252j,
            40459.79897941102 + 20229.89948970551j,
            40459.79897941101 + 20229.899489705513j,
        ],
    ),
    rlf.PowerLoad(
        id=9,
        bus=buses[10],
        phases="abcn",
        powers=[
            37922.04164877094 + 18961.020824385465j,
            37922.04164985973 + 18961.020824929878j,
            37922.04164980376 + 18961.02082490188j,
        ],
    ),
    rlf.PowerLoad(
        id=10,
        bus=buses[11],
        phases="abcn",
        powers=[
            40459.798978684 + 20229.899489342002j,
            40459.79897977452 + 20229.899489887266j,
            40459.798978684004 + 20229.899489342002j,
        ],
    ),
    rlf.PowerLoad(
        id=11,
        bus=buses[12],
        phases="abcn",
        powers=[
            41916.48223002361 + 20958.24111501181j,
            41916.4822311534 + 20958.241115576693j,
            41916.48223002362 + 20958.241115011817j,
        ],
    ),
    rlf.PowerLoad(
        id=12,
        bus=buses[13],
        phases="abcn",
        powers=[
            40932.79932474137 + 20466.399662370684j,
            40932.79932583017 + 20466.399662915086j,
            40932.799324797365 + 20466.399662398682j,
        ],
    ),
]

# Transformers
tp = {
    "160kVA_Dd0": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Dd0",
        vg="dd0",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Dd6": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Dd6",
        vg="dd6",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Dyn11": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Dyn11",
        vg="dyn11",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Dyn5": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Dyn5",
        vg="dyn5",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Dzn0": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Dzn0",
        vg="dzn0",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Dzn6": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Dzn6",
        vg="dzn6",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Yd11": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Yd11",
        vg="ynd11",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Yd5": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Yd5",
        vg="ynd5",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Yyn0": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Yyn0",
        vg="ynyn0",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Yyn6": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Yyn6",
        vg="ynyn6",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Yzn11": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Yzn11",
        vg="ynzn11",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
    "160kVA_Yzn5": rlf.TransformerParameters.from_open_and_short_circuit_tests(
        id="160kVA_Yzn5",
        vg="ynzn5",
        sn=160000.0,
        uhv=20000.0,
        ulv=400.0,
        i0=0.023,
        p0=460.0,
        psc=2350.0,
        vsc=0.04,
    ),
}
p = Point(0.0, 0.5)
transformers = [
    rlf.Transformer(
        id="tr1",
        bus_hv=buses[1],
        bus_lv=buses[2],
        phases_hv="abc",
        phases_lv="abc",
        parameters=tp["160kVA_Dd0"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr2",
        bus_hv=buses[1],
        bus_lv=buses[3],
        phases_hv="abcn",
        phases_lv="abcn",
        parameters=tp["160kVA_Yyn0"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr3",
        bus_hv=buses[1],
        bus_lv=buses[4],
        phases_hv="abc",
        phases_lv="abcn",
        parameters=tp["160kVA_Dzn0"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr4",
        bus_hv=buses[1],
        bus_lv=buses[5],
        phases_hv="abc",
        phases_lv="abcn",
        parameters=tp["160kVA_Dyn11"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr5",
        bus_hv=buses[1],
        bus_lv=buses[6],
        phases_hv="abcn",
        phases_lv="abc",
        parameters=tp["160kVA_Yd11"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr6",
        bus_hv=buses[1],
        bus_lv=buses[7],
        phases_hv="abcn",
        phases_lv="abcn",
        parameters=tp["160kVA_Yzn11"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr7",
        bus_hv=buses[1],
        bus_lv=buses[8],
        phases_hv="abc",
        phases_lv="abc",
        parameters=tp["160kVA_Dd6"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr8",
        bus_hv=buses[1],
        bus_lv=buses[9],
        phases_hv="abcn",
        phases_lv="abcn",
        parameters=tp["160kVA_Yyn6"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr9",
        bus_hv=buses[1],
        bus_lv=buses[10],
        phases_hv="abc",
        phases_lv="abcn",
        parameters=tp["160kVA_Dzn6"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr10",
        bus_hv=buses[1],
        bus_lv=buses[11],
        phases_hv="abc",
        phases_lv="abcn",
        parameters=tp["160kVA_Dyn5"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr11",
        bus_hv=buses[1],
        bus_lv=buses[12],
        phases_hv="abcn",
        phases_lv="abc",
        parameters=tp["160kVA_Yd5"],
        tap=1,
        geometry=p,
    ),
    rlf.Transformer(
        id="tr12",
        bus_hv=buses[1],
        bus_lv=buses[13],
        phases_hv="abcn",
        phases_lv="abcn",
        parameters=tp["160kVA_Yzn5"],
        tap=1,
        geometry=p,
    ),
]

en = rlf.ElectricalNetwork(
    buses=buses,
    lines=[],
    transformers=transformers,
    switches=[],
    loads=loads,
    sources=[vs],
    grounds=[ground],
    potential_refs=potential_refs,
)
